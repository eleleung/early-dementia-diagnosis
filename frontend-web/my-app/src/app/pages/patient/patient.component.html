<div id="overview-content">
    <h1 class="ui header">{{patient.firstName}} {{patient.lastName}}</h1>
    <div class="ui divider"></div>

    <lsu-tabset type="'pointing'">
        <lsu-tab [headerText]="'Completed Tests'" [active]="'true'">
            <br/>
            <div style="display:inline-block; width: 100%">
                <div class="ui icon input">
                    <input type="text" placeholder="Search...">
                    <i class="circular search link icon"></i>
                </div>
            </div>
            <table class="ui table">
                <thead>
                    <th>Date</th>
                    <th>Test Name</th>
                    <th>Description</th>
                    <th>Creator</th>
                    <th>Details</th>
                </thead>
                <tbody>
                    <tr *ngFor="let testResult of testResults">
                        <td>{{testResult.date | date: 'dd/MM/yyyy'}}</td>
                        <td>{{testResult.test.name}}</td>
                        <td>{{testResult.test.description}}</td>
                        <td>{{testResult.test.creator[0].firstName}} {{testResult.test.creator[0].lastName}}</td>
                        <td>
                            <button class="ui icon button primary-button" lsu-popup [trigger]="'hover'"
                                    [content]="'View Details'"
                                    (click)="openCompletedTestModal(testResult)">
                                        <i class="plus icon"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </lsu-tab>
        <lsu-tab [headerText]="'Assigned Tests'">
            <br/>
            <div style="display:inline-block; width: 100%">
                <div class="ui icon input">
                    <input type="text" placeholder="Search...">
                    <i class="circular search link icon"></i>
                </div>
                <button class="ui icon button primary-button" style="float: right" lsu-popup [trigger]="'hover'" [content]="'Assign a new test'" (click)="assignModal = true">
                    <i class="plus icon"></i>
                </button>
            </div>
            <table class="ui table">
                <thead>
                    <th>Name</th>
                    <th>Assigned by</th>
                    <th>Created by</th>
                </thead>
                <tbody>
                    <tr *ngFor="let test of patientTests">
                        <td>{{test.name}}</td>
                        <td>{{test.creator[0].firstName}} {{test.creator[0].lastName}}</td>
                        <td>{{test.creator[0].firstName}} {{test.creator[0].lastName}}</td>
                    </tr>
                </tbody>
            </table>
        </lsu-tab>
        <lsu-tab [headerText]="'Patient Details'">
            <form class="ui form">
                <br>
                <div class="two fields">
                    <div class="field">
                        <label>First Name</label>
                        <input disabled type="text" id="first-name" [(ngModel)]="patient.firstName" name="first-name">
                    </div>
                    <div class="field">
                        <label>Last Name</label>
                        <input disabled type="text" id="last-name" [(ngModel)]="patient.lastName" name="last-name">
                    </div>
                </div>
                <div class="two fields">
                    <div class="field">
                        <label>Gender</label>
                        <input disabled type="text" [(ngModel)]="patient.gender" name="gender">
                    </div>
                    <div class="field">
                        <label>Date of Birth</label>
                        <input disabled type="text" [(ngModel)]="pipedDateOfBirth" name="dateOfBirth">
                    </div>
                </div>
                <div class="field">
                    <table>

                    </table>
                </div>
            </form>
        </lsu-tab>
    </lsu-tabset>

    <lsu-modal [(ngModel)]="completedTestModal" *ngIf="testResult != null">
        <div class="header">
            Completed Test Details
        </div>
        <div class="content">
            <table class="ui table">
                <thead>
                    <th>Instruction</th>
                    <th>Content</th>
                    <th>Result</th>
                    <th>Download File</th>
                </thead>
                <tbody>
                    <tr *ngFor="let section of testResult.test.components; let i = index">
                        <td>{{section.instruction}}</td>
                        <td>{{section.content !== '' ? section.content : 'N/A'}}</td>
                        <td>{{handleComponentTypes(section, i)}}</td>
                        <td>
                            <i (click)="handleRawFiles(section, i)" class="download icon"></i>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="actions">
            <div class="ui secondary deny button" (click)="closeCompletedTestModal()">
                Close
            </div>
        </div>
    </lsu-modal>

    <lsu-modal [(ngModel)]="assignModal" [options]="modalOptions">
        <div class="header">
            Choose a New Test
        </div>
        <div class="content">
            <table class="ui table">
                <thead>
                    <th>Test Name</th>
                    <th>Created by</th>
                    <th>Description</th>
                    <th>Add</th>
                </thead>
                <tbody>
                    <tr *ngFor="let test of userTests">
                        <td>{{test.name}}</td>
                        <td>{{test.creator[0].firstName}} {{test.creator[0].lastName}}</td>
                        <td>{{test.description}}</td>
                        <td>
                            <button class="ui icon button" lsu-popup [trigger]="'hover'" [content]="'Assign this test'" (click)="addTest(test)">
                                <i class="plus icon"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="actions">
            <div class="ui secondary deny button" (click)="assignModal = false">
                Close
            </div>
        </div>
    </lsu-modal>
</div>
